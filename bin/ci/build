#!/usr/bin/env bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null && pwd )"

: "${AWS_ACCESS_KEY_ID:?'Set the AWS_ACCESS_KEY_ID environment variable'}"
: "${AWS_SECRET_ACCESS_KEY:?'Set the AWS_SECRET_ACCESS_KEY environment variable'}"
: "${AWS_DEFAULT_REGION:?'Set the AWS_DEFAULT_REGION environment variable'}"

# shellcheck disable=SC1090
source "${DIR}/common.sh"

echo "Building ${TF_WORKSPACE} ..."
terraform plan \
  -no-color \
  -input=false \
  -lock=false \
  -var "environment=${TF_WORKSPACE}" \
  -out="${tfplan:?}"
#  -var "build_id=${CI_COMMIT_ID:-$(git rev-parse --short HEAD)}" \
